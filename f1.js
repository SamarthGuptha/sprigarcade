const player = 'p';
const box = 'b';
const goal = 'g';
const wall = 'w';
const fightingwall = 'f';
setLegend(
    [ player, bitmap`
................
................
................
................
....444444444...
....403000304...
....400000004...
....433000334...
....403333304...
....400000004...
....44L444L44...
......L...L.....
....LLL...LLL...
................
................
................` ],
  [ box, bitmap`
................
................
................
................
................
................
................
................
.....99999......
.....00000......
.....00000......
.....00000......
.....00000......
.....00000......
.....00000......
.....99999......` ],
  [ goal, bitmap`
................
................
......0000......
......00.00.....
......00000.....
......00000.....
......0.000.....
......0.0000....
......0..0.0....
......00...0....
.......0000.....
................
................
................
................
................`],
  [ wall, bitmap`
.....66666......
.....66666......
.....66666......
.....66666......
.....66666......
.....66666......
.....66666......
.....66666......
.....66666......
.....66666......
................
................
................
................
................
................`],
  [ fightingwall, bitmap`
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......
......333.......`]
);

let level = 0;

const levels = [
  map`
....w.
......
p.b..g`,
  map`
........
..w.....
.b.....g
.w...w..
p.......`,
  map`
.......w..g
.....w..w..
....w......
.w..w......
pb.w.......`,
  map`
...w....
...w....
...f....
p.bw...g`,
  map`
www....ww
ww..ww.ww
ww.wg..ww
w...wwwww
p.wwwwwww`
];
const currentLevel = levels[level];
setMap(currentLevel);
setSolids([ player, wall, box]);

onInput("w", () => {
  getFirst(player).y -= 1;
});
onInput("s", () => {
  getFirst(player).y += 1;
})
onInput("a", () => {
  getFirst(player).x -=1;
})
onInput("d", () => {
  getFirst(player).x +=1;
})
  onInput("j", () => {
  getFirst(box).y -=1;
})
onInput("k", () => {
  getFirst(box).y +=1;
})
onInput("l", () => {
  const currentLevel = levels[level];
  if(currentLevel !== undefined) setMap(currentLevel);
})

setPushables({[ player ]: [ box ]});

afterInput(()=> {
  const numberCovered = tilesWith(goal, box).length;
  const targetNum = tilesWith(goal).length;
  const fightwall = tilesWith(fightingwall, box);
  if(numberCovered === targetNum) {
    level++

    const currentLevel = levels[level];

    if (currentLevel !== undefined){ 
      setMap(currentLevel);} else {addText("You Win()", { y: 0, color: color`7` })}
  }
});
afterInput(() => {
  const fightwall = tilesWith(fightingwall, box).length;
  const targetF = tilesWith(box).length;

  if(fightwall === targetF){
    setMap(map`
www....ww
ww..ww.ww
ww.wg..ww
w...wwwww
p..wwwwww`);
  }
}
)
